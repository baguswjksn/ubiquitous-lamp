<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ book.title }} - Details</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        #graph {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }

        .quote-card {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <h1>{{ book.title }}</h1>
    <p><strong>Author:</strong> {{ book.author_name }}</p>
    <p><strong>Status:</strong> {{ book.status }}</p>
    <p><strong>Pages:</strong> {{ book.current_page }} / {{ book.total_pages }}</p>

    <h2>Graph View</h2>
    <!-- Store book and quotes JSON in data attributes -->
    <div id="book-data" data-book='{{ book|tojson|safe }}' data-quotes='{{ quotes|tojson|safe }}'>
    </div>

    <div id="graph"></div>

    <script>
        // Get JSON from the DOM
        var bookDataDiv = document.getElementById('book-data');
        var book = JSON.parse(bookDataDiv.dataset.book);
        var quotes = JSON.parse(bookDataDiv.dataset.quotes);

        var nodes = [
            { id: 'book', label: book.title, color: '#FFD700', shape: 'box' }
        ];

        var edges = [];

        quotes.forEach(function (quote) {
            nodes.push({
                id: 'q' + quote.id,
                label: quote.content,
                shape: 'box',
                color: '#87CEFA'
            });
            edges.push({ from: 'book', to: 'q' + quote.id });
        });

        var container = document.getElementById('graph');
        var data = {
            nodes: new vis.DataSet(nodes),
            edges: new vis.DataSet(edges)
        };
        var options = {
            layout: { hierarchical: false },
            nodes: { font: { size: 14, multi: 'html' }, margin: 10 },
            edges: { smooth: true }
        };
        var network = new vis.Network(container, data, options);
    </script>

    <h2>Quotes</h2>
    {% for quote in quotes %}
    <div class="quote-card">
        <p>{{ quote.content }}</p>
        {% if quote.page_number %}<small>Page: {{ quote.page_number }}</small>{% endif %}
    </div>
    {% else %}
    <p>No quotes yet.</p>
    {% endfor %}
    <!-- PAGE SELECTOR -->
    {% include "components/page-nav.html" %}
</body>

</html>